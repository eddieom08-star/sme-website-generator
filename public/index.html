<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forge â€” AI Website Generator</title>
  <meta name="description" content="Generate professional websites for small businesses using AI">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            forge: {
              bg: '#0a0a0b',
              surface: '#141416',
              elevated: '#1c1c1f',
              border: '#2a2a2d',
              muted: '#71717a',
              text: '#fafafa',
            },
            amber: {
              400: '#fbbf24',
              500: '#f59e0b',
              600: '#d97706',
            },
            emerald: {
              400: '#34d399',
              500: '#10b981',
            }
          },
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: #0a0a0b;
      color: #fafafa;
      -webkit-font-smoothing: antialiased;
    }

    .font-mono { font-family: 'JetBrains Mono', monospace; }

    /* Subtle noise texture overlay */
    .noise::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.015;
      pointer-events: none;
      z-index: 9999;
    }

    /* Sidebar gradient */
    .sidebar-gradient {
      background: linear-gradient(180deg, #141416 0%, #0f0f10 100%);
      border-right: 1px solid rgba(255,255,255,0.04);
    }

    /* Glass card effect */
    .glass-card {
      background: rgba(28, 28, 31, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.06);
    }

    /* Ambient glow effects */
    .glow-amber {
      box-shadow: 0 0 60px -15px rgba(251, 191, 36, 0.15);
    }

    .glow-emerald {
      box-shadow: 0 0 40px -10px rgba(52, 211, 153, 0.2);
    }

    /* Input styling */
    .forge-input {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .forge-input:hover {
      border-color: rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
    }

    .forge-input:focus {
      outline: none;
      border-color: #f59e0b;
      background: rgba(255,255,255,0.05);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .forge-input::placeholder {
      color: #52525b;
    }

    /* Button styling */
    .forge-btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      box-shadow: 0 4px 14px -3px rgba(245, 158, 11, 0.4),
                  inset 0 1px 0 rgba(255,255,255,0.1);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .forge-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px -3px rgba(245, 158, 11, 0.5),
                  inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .forge-btn-primary:active {
      transform: translateY(0);
    }

    /* Sidebar items */
    .sidebar-item {
      transition: all 0.15s ease;
      border-left: 2px solid transparent;
    }

    .sidebar-item:hover {
      background: rgba(255,255,255,0.03);
    }

    .sidebar-item.active {
      background: rgba(245, 158, 11, 0.08);
      border-left-color: #f59e0b;
    }

    /* Submenu animation */
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .submenu.open {
      max-height: 280px;
    }

    .submenu-item {
      transition: all 0.15s ease;
    }

    .submenu-item:hover {
      background: rgba(255,255,255,0.04);
      color: #fafafa;
    }

    /* Progress bar */
    .progress-track {
      background: rgba(255,255,255,0.06);
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Pulse animation for processing */
    @keyframes pulse-ring {
      0% { transform: scale(0.95); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
      100% { transform: scale(0.95); opacity: 1; }
    }

    .processing-ring {
      animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Fade in animation */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeUp 0.35s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Staggered children */
    .stagger-children > * {
      opacity: 0;
      animation: fadeUp 0.35s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    .stagger-children > *:nth-child(1) { animation-delay: 0.05s; }
    .stagger-children > *:nth-child(2) { animation-delay: 0.1s; }
    .stagger-children > *:nth-child(3) { animation-delay: 0.15s; }
    .stagger-children > *:nth-child(4) { animation-delay: 0.2s; }

    /* Status dot pulse */
    @keyframes dot-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-dot-live {
      animation: dot-pulse 2s ease-in-out infinite;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.15);
    }

    /* Stats card hover */
    .stat-card {
      transition: all 0.2s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.1);
    }

    /* Badge styling */
    .badge {
      font-size: 0.65rem;
      letter-spacing: 0.025em;
      text-transform: uppercase;
    }
  </style>
</head>
<body class="noise min-h-screen">

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-72 sidebar-gradient flex flex-col fixed h-full z-20">
      <!-- Logo -->
      <div class="p-6 border-b border-white/[0.04]">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center shadow-lg shadow-amber-500/20">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-lg font-semibold tracking-tight">Forge</h1>
            <p class="text-xs text-forge-muted font-mono">v1.0.0</p>
          </div>
        </div>
      </div>

      <!-- New Site Button -->
      <div class="p-4">
        <button id="new-site-sidebar-btn" class="forge-btn-primary w-full py-3 px-4 text-forge-bg font-semibold rounded-xl flex items-center justify-center gap-2 text-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          New Website
        </button>
      </div>

      <!-- Sites List -->
      <div class="flex-1 overflow-y-auto px-3">
        <div class="px-3 py-3">
          <span class="text-[10px] font-semibold text-forge-muted uppercase tracking-widest">Your Sites</span>
        </div>
        <nav id="sites-list" class="space-y-1">
          <div id="no-sites-message" class="px-4 py-10 text-center">
            <div class="w-12 h-12 mx-auto mb-4 rounded-xl bg-white/[0.03] flex items-center justify-center">
              <svg class="w-6 h-6 text-forge-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
            </div>
            <p class="text-sm text-forge-muted">No sites yet</p>
            <p class="text-xs text-forge-muted/60 mt-1">Create your first website</p>
          </div>
        </nav>
      </div>

      <!-- Footer -->
      <div class="p-4 border-t border-white/[0.04]">
        <div class="flex items-center gap-3 px-2">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 flex items-center justify-center">
            <span class="text-xs font-medium text-emerald-400">AI</span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium truncate">Powered by Claude</p>
            <p class="text-xs text-forge-muted">Anthropic</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 ml-72">
      <!-- Top Bar -->
      <header class="sticky top-0 z-10 bg-forge-bg/80 backdrop-blur-xl border-b border-white/[0.04]">
        <div class="px-8 py-5 flex items-center justify-between">
          <div>
            <h2 id="page-title" class="text-xl font-semibold tracking-tight">Dashboard</h2>
            <p id="page-subtitle" class="text-sm text-forge-muted mt-0.5">Manage your generated websites</p>
          </div>
          <div class="flex items-center gap-4">
            <span id="active-site-badge" class="hidden badge px-3 py-1.5 bg-amber-500/10 text-amber-400 rounded-lg font-medium"></span>
          </div>
        </div>
      </header>

      <!-- Content -->
      <div class="p-8">
        <!-- Dashboard Home -->
        <div id="dashboard-home" class="fade-in">
          <!-- Stats Grid -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8 stagger-children">
            <div class="stat-card glass-card rounded-2xl p-6 cursor-default">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-sm text-forge-muted mb-1">Total Sites</p>
                  <p id="total-sites-count" class="text-3xl font-semibold tracking-tight">0</p>
                </div>
                <div class="w-11 h-11 rounded-xl bg-amber-500/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="stat-card glass-card rounded-2xl p-6 cursor-default">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-sm text-forge-muted mb-1">Live Sites</p>
                  <p id="live-sites-count" class="text-3xl font-semibold tracking-tight text-emerald-400">0</p>
                </div>
                <div class="w-11 h-11 rounded-xl bg-emerald-500/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="stat-card glass-card rounded-2xl p-6 cursor-default">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-sm text-forge-muted mb-1">Avg Quality</p>
                  <p id="avg-quality-score" class="text-3xl font-semibold tracking-tight">â€”</p>
                </div>
                <div class="w-11 h-11 rounded-xl bg-violet-500/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="glass-card rounded-2xl p-6">
            <h3 class="text-base font-semibold mb-5">Quick Actions</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <button id="quick-new-site" class="group p-5 rounded-xl border border-dashed border-white/10 hover:border-amber-500/40 hover:bg-amber-500/[0.03] transition-all duration-200 text-left">
                <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center mb-4 group-hover:scale-105 transition-transform">
                  <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                  </svg>
                </div>
                <p class="font-medium text-forge-text group-hover:text-amber-400 transition-colors">Generate New Site</p>
                <p class="text-sm text-forge-muted mt-1">Create a website for a new business</p>
              </button>
            </div>
          </div>
        </div>

        <!-- Generator Form -->
        <div id="generator-section" class="hidden fade-in">
          <div class="max-w-2xl mx-auto">
            <div class="glass-card rounded-2xl p-8 glow-amber">
              <div class="text-center mb-8">
                <div class="w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center shadow-lg shadow-amber-500/25">
                  <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                </div>
                <h2 class="text-2xl font-semibold tracking-tight">Generate a Website</h2>
                <p class="text-forge-muted mt-2">Enter business details and we'll create a stunning website</p>
              </div>

              <form id="generate-form" class="space-y-5">
                <div>
                  <label class="block text-sm font-medium text-forge-muted mb-2">
                    Business Name <span class="text-amber-500">*</span>
                  </label>
                  <input
                    type="text"
                    id="businessName"
                    name="businessName"
                    required
                    placeholder="e.g. Thompson's Heating & Plumbing"
                    class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text"
                  >
                </div>

                <div>
                  <label class="block text-sm font-medium text-forge-muted mb-2">Location</label>
                  <input
                    type="text"
                    id="location"
                    name="location"
                    placeholder="e.g. Manchester, UK"
                    class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text"
                  >
                </div>

                <div>
                  <label class="block text-sm font-medium text-forge-muted mb-2">Google Maps Link</label>
                  <input
                    type="url"
                    id="googleMapsUrl"
                    name="googleMapsUrl"
                    placeholder="https://maps.app.goo.gl/..."
                    class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text font-mono text-sm"
                  >
                  <p class="text-xs text-forge-muted/60 mt-2">Paste share link from Google Maps</p>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-forge-muted mb-2">Website URL</label>
                    <input
                      type="url"
                      id="websiteUrl"
                      name="websiteUrl"
                      placeholder="https://example.com"
                      class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text font-mono text-sm"
                    >
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-forge-muted mb-2">Facebook</label>
                    <input
                      type="url"
                      id="facebookUrl"
                      name="facebookUrl"
                      placeholder="https://facebook.com/..."
                      class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text font-mono text-sm"
                    >
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-forge-muted mb-2">Instagram</label>
                    <input
                      type="text"
                      id="instagramUrl"
                      name="instagramUrl"
                      placeholder="@username"
                      class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text"
                    >
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-forge-muted mb-2">LinkedIn</label>
                    <input
                      type="url"
                      id="linkedinUrl"
                      name="linkedinUrl"
                      placeholder="https://linkedin.com/..."
                      class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text font-mono text-sm"
                    >
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-forge-muted mb-2">
                    Business Images <span class="text-forge-muted/60">(up to 5 image URLs)</span>
                  </label>
                  <div id="image-urls-container" class="space-y-2">
                    <div class="flex gap-2">
                      <input
                        type="url"
                        name="imageUrl"
                        placeholder="https://example.com/image1.jpg"
                        class="forge-input flex-1 px-4 py-3 rounded-xl text-forge-text font-mono text-sm"
                      >
                      <button type="button" onclick="addImageUrlField()" class="px-4 py-3 border border-white/10 hover:border-white/20 rounded-xl text-forge-muted hover:text-forge-text transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <p class="text-xs text-forge-muted/60 mt-2">Add URLs to your business photos for a more personalized website</p>
                </div>

                <div>
                  <label class="block text-sm font-medium text-forge-muted mb-2">Additional Information</label>
                  <textarea
                    id="additionalInfo"
                    name="additionalInfo"
                    rows="3"
                    placeholder="Services, unique selling points, style preferences..."
                    class="forge-input w-full px-4 py-3.5 rounded-xl text-forge-text resize-none"
                  ></textarea>
                </div>

                <button
                  type="submit"
                  id="submit-btn"
                  class="forge-btn-primary w-full py-4 text-forge-bg font-semibold rounded-xl text-base mt-2"
                >
                  Generate Website
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Progress Section -->
        <div id="progress-section" class="hidden fade-in">
          <div class="max-w-lg mx-auto">
            <div class="glass-card rounded-2xl p-10 text-center glow-amber">
              <div id="progress-icon" class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-amber-500/20 to-amber-600/20 flex items-center justify-center processing-ring">
                <span class="text-3xl font-mono font-medium text-amber-400" id="status-emoji">âš¡</span>
              </div>

              <h2 id="progress-title" class="text-xl font-semibold mb-2">Generating your website...</h2>
              <p id="progress-step" class="text-forge-muted mb-8">Starting up...</p>

              <div class="progress-track w-full h-1.5 rounded-full mb-4">
                <div id="progress-bar" class="progress-fill h-full rounded-full" style="width: 0%"></div>
              </div>
              <p id="progress-percent" class="text-sm font-mono text-forge-muted">0%</p>
            </div>
          </div>
        </div>

        <!-- Site Overview -->
        <div id="site-overview" class="hidden fade-in">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 stagger-children">
            <div class="lg:col-span-2 space-y-6">
              <div class="glass-card rounded-2xl p-6">
                <div class="flex items-start justify-between mb-5">
                  <div>
                    <h3 id="site-name-display" class="text-xl font-semibold"></h3>
                    <p id="site-location-display" class="text-forge-muted text-sm mt-1"></p>
                  </div>
                  <span id="site-status-badge" class="badge px-3 py-1.5 bg-emerald-500/10 text-emerald-400 rounded-lg font-medium flex items-center gap-1.5">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 status-dot-live"></span>
                    Live
                  </span>
                </div>
                <div class="flex flex-wrap gap-3">
                  <a id="site-live-link" href="#" target="_blank" class="forge-btn-primary px-5 py-2.5 text-forge-bg rounded-lg text-sm font-medium inline-flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                    View Live
                  </a>
                  <a id="site-preview-link" href="#" target="_blank" class="px-5 py-2.5 border border-white/10 hover:border-white/20 rounded-lg text-sm font-medium transition-colors">
                    Preview
                  </a>
                  <button id="regenerate-btn" class="px-5 py-2.5 border border-amber-500/30 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg text-sm font-medium text-amber-400 transition-colors inline-flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Regenerate
                  </button>
                  <button id="delete-btn" class="px-5 py-2.5 border border-red-500/30 hover:border-red-500/50 hover:bg-red-500/10 rounded-lg text-sm font-medium text-red-400 transition-colors inline-flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Delete
                  </button>
                </div>
              </div>

              <div class="grid grid-cols-3 gap-4">
                <div class="glass-card rounded-xl p-5 text-center">
                  <p id="site-quality" class="text-2xl font-semibold text-amber-400">â€”</p>
                  <p class="text-xs text-forge-muted mt-1">Quality</p>
                </div>
                <div class="glass-card rounded-xl p-5 text-center">
                  <p class="text-2xl font-semibold text-emerald-400">â€”</p>
                  <p class="text-xs text-forge-muted mt-1">Visitors</p>
                </div>
                <div class="glass-card rounded-xl p-5 text-center">
                  <p class="text-2xl font-semibold text-violet-400">â€”</p>
                  <p class="text-xs text-forge-muted mt-1">Leads</p>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div class="glass-card rounded-xl p-5">
                <h4 class="text-sm font-semibold text-forge-muted mb-4">Management</h4>
                <div class="space-y-1">
                  <button data-section="payments" class="submenu-nav w-full text-left px-3 py-2.5 rounded-lg text-sm text-forge-muted hover:text-forge-text transition-colors flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    Payments
                  </button>
                  <button data-section="leads" class="submenu-nav w-full text-left px-3 py-2.5 rounded-lg text-sm text-forge-muted hover:text-forge-text transition-colors flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    Leads
                  </button>
                  <button data-section="ai-receptionist" class="submenu-nav w-full text-left px-3 py-2.5 rounded-lg text-sm text-forge-muted hover:text-forge-text transition-colors flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                    AI Receptionist
                  </button>
                </div>
              </div>
              <div class="glass-card rounded-xl p-5">
                <h4 class="text-sm font-semibold text-forge-muted mb-4">Environments</h4>
                <div class="space-y-1">
                  <button data-section="staging" class="submenu-nav w-full text-left px-3 py-2.5 rounded-lg text-sm text-forge-muted hover:text-forge-text transition-colors flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                    </svg>
                    Staging
                  </button>
                  <button data-section="production" class="submenu-nav w-full text-left px-3 py-2.5 rounded-lg text-sm text-forge-muted hover:text-forge-text transition-colors flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                    Production
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payments Section -->
        <div id="payments-section" class="hidden fade-in">
          <div class="glass-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6">Payments</h3>
            <div class="text-center py-16">
              <div class="w-16 h-16 mx-auto mb-5 rounded-2xl bg-emerald-500/10 flex items-center justify-center">
                <svg class="w-8 h-8 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
              </div>
              <p class="font-medium">Payment integration coming soon</p>
              <p class="text-sm text-forge-muted mt-2">Accept payments directly through your website</p>
            </div>
          </div>
        </div>

        <!-- Leads Section -->
        <div id="leads-section" class="hidden fade-in">
          <div class="glass-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6">Leads</h3>
            <div class="text-center py-16">
              <div class="w-16 h-16 mx-auto mb-5 rounded-2xl bg-violet-500/10 flex items-center justify-center">
                <svg class="w-8 h-8 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
              </div>
              <p class="font-medium">No leads captured yet</p>
              <p class="text-sm text-forge-muted mt-2">Form submissions will appear here</p>
            </div>
          </div>
        </div>

        <!-- AI Receptionist Section -->
        <div id="ai-receptionist-section" class="hidden fade-in">
          <div class="glass-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6">AI Receptionist</h3>
            <div class="text-center py-16">
              <div class="w-16 h-16 mx-auto mb-5 rounded-2xl bg-amber-500/10 flex items-center justify-center">
                <svg class="w-8 h-8 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                </svg>
              </div>
              <p class="font-medium">AI Receptionist coming soon</p>
              <p class="text-sm text-forge-muted mt-2">24/7 automated customer support</p>
            </div>
          </div>
        </div>

        <!-- Staging Section -->
        <div id="staging-section" class="hidden fade-in">
          <div class="glass-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6">Staging Environment</h3>
            <div class="space-y-5">
              <p class="text-forge-muted">Test changes before going live</p>
              <div class="bg-white/[0.02] rounded-xl p-5 border border-white/[0.04]">
                <p class="text-xs text-forge-muted mb-2 uppercase tracking-wider">Staging URL</p>
                <p id="staging-url" class="font-mono text-sm text-amber-400">â€”</p>
              </div>
              <button class="px-5 py-2.5 bg-amber-500/10 hover:bg-amber-500/20 text-amber-400 rounded-lg text-sm font-medium transition-colors">
                Deploy to Staging
              </button>
            </div>
          </div>
        </div>

        <!-- Production Section -->
        <div id="production-section" class="hidden fade-in">
          <div class="glass-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6">Production Environment</h3>
            <div class="space-y-5">
              <p class="text-forge-muted">Your live website</p>
              <div class="bg-white/[0.02] rounded-xl p-5 border border-white/[0.04]">
                <p class="text-xs text-forge-muted mb-2 uppercase tracking-wider">Production URL</p>
                <p id="production-url" class="font-mono text-sm text-emerald-400">â€”</p>
              </div>
              <div class="flex gap-3">
                <button class="px-5 py-2.5 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 rounded-lg text-sm font-medium transition-colors">
                  Promote from Staging
                </button>
                <button class="px-5 py-2.5 border border-red-500/20 hover:bg-red-500/10 text-red-400 rounded-lg text-sm font-medium transition-colors">
                  Rollback
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Error Section -->
        <div id="error-section" class="hidden fade-in">
          <div class="max-w-lg mx-auto">
            <div class="glass-card rounded-2xl p-10 text-center">
              <div class="w-16 h-16 mx-auto mb-5 rounded-2xl bg-red-500/10 flex items-center justify-center">
                <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
              </div>
              <h2 class="text-xl font-semibold mb-2">Generation Failed</h2>
              <p id="error-message" class="text-forge-muted mb-6">Something went wrong. Please try again.</p>
              <button id="retry-btn" class="forge-btn-primary px-8 py-3 text-forge-bg rounded-xl font-medium">
                Try Again
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = '/api';

    let sites = JSON.parse(localStorage.getItem('websiteforge_sites') || '[]');
    let currentJobId = null;
    let pollInterval = null;
    let activeSiteId = null;
    let activeSection = 'dashboard';

    const sitesList = document.getElementById('sites-list');
    const noSitesMessage = document.getElementById('no-sites-message');
    const pageTitle = document.getElementById('page-title');
    const pageSubtitle = document.getElementById('page-subtitle');
    const activeSiteBadge = document.getElementById('active-site-badge');

    const sections = {
      'dashboard-home': document.getElementById('dashboard-home'),
      'generator': document.getElementById('generator-section'),
      'progress': document.getElementById('progress-section'),
      'overview': document.getElementById('site-overview'),
      'payments': document.getElementById('payments-section'),
      'leads': document.getElementById('leads-section'),
      'ai-receptionist': document.getElementById('ai-receptionist-section'),
      'staging': document.getElementById('staging-section'),
      'production': document.getElementById('production-section'),
      'error': document.getElementById('error-section'),
    };

    async function init() {
      await syncWithDatabase();
      renderSitesList();
      updateDashboardStats();
      showSection('dashboard-home');

      document.getElementById('new-site-sidebar-btn').addEventListener('click', showGenerator);
      document.getElementById('quick-new-site').addEventListener('click', showGenerator);
      document.getElementById('generate-form').addEventListener('submit', handleGenerate);
      document.getElementById('retry-btn').addEventListener('click', showGenerator);
      document.getElementById('regenerate-btn').addEventListener('click', handleRegenerate);
      document.getElementById('delete-btn').addEventListener('click', handleDelete);

      document.querySelectorAll('.submenu-nav').forEach(btn => {
        btn.addEventListener('click', () => {
          const section = btn.dataset.section;
          showSection(section);
          updatePageHeader(section);
        });
      });
    }

    async function syncWithDatabase() {
      try {
        const response = await fetch(`${API_BASE}/sites`);
        if (response.ok) {
          const data = await response.json();
          if (data.sites && data.sites.length > 0) {
            const dbSites = data.sites.map(s => ({
              id: s.id, jobId: s.jobId, name: s.name, location: s.location,
              url: s.url, deployed: s.deployed, qualityScore: s.qualityScore, createdAt: s.createdAt,
            }));
            const dbJobIds = new Set(dbSites.map(s => s.jobId));
            const merged = [...dbSites, ...sites.filter(s => !dbJobIds.has(s.jobId))];
            sites = merged.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            localStorage.setItem('websiteforge_sites', JSON.stringify(sites));
          }
        }
      } catch (err) { console.log('Database sync skipped'); }
    }

    function renderSitesList() {
      const existingSiteItems = sitesList.querySelectorAll('.site-item');
      existingSiteItems.forEach(item => item.remove());

      if (sites.length === 0) {
        noSitesMessage.classList.remove('hidden');
        return;
      }

      noSitesMessage.classList.add('hidden');

      sites.forEach(site => {
        const siteEl = document.createElement('div');
        siteEl.className = 'site-item';
        siteEl.innerHTML = `
          <div class="sidebar-item rounded-lg cursor-pointer ${activeSiteId === site.id ? 'active' : ''}" data-site-id="${site.id}">
            <div class="px-3 py-3 flex items-center justify-between">
              <div class="flex items-center gap-3 min-w-0">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500/20 to-amber-600/20 flex items-center justify-center flex-shrink-0">
                  <span class="text-xs font-semibold text-amber-400">${site.name.charAt(0).toUpperCase()}</span>
                </div>
                <div class="truncate">
                  <p class="text-sm font-medium truncate">${site.name}</p>
                  <p class="text-xs text-forge-muted truncate">${site.location || 'No location'}</p>
                </div>
              </div>
              <span class="w-2 h-2 rounded-full flex-shrink-0 ${site.deployed ? 'bg-emerald-400 status-dot-live' : 'bg-amber-400'}"></span>
            </div>
            <div class="submenu ${activeSiteId === site.id ? 'open' : ''}" id="submenu-${site.id}">
              <div class="pl-14 pr-3 pb-3 space-y-0.5">
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="overview">Overview</button>
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="payments">Payments</button>
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="leads">Leads</button>
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="ai-receptionist">AI Receptionist</button>
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="staging">Staging</button>
                <button class="submenu-item w-full text-left px-3 py-2 rounded-lg text-xs text-forge-muted" data-site="${site.id}" data-section="production">Production</button>
              </div>
            </div>
          </div>
        `;

        const sidebarItem = siteEl.querySelector('.sidebar-item');
        sidebarItem.addEventListener('click', (e) => {
          if (e.target.classList.contains('submenu-item')) return;
          toggleSite(site.id);
        });

        siteEl.querySelectorAll('.submenu-item').forEach(btn => {
          btn.addEventListener('click', () => {
            activeSiteId = btn.dataset.site;
            showSiteSection(btn.dataset.site, btn.dataset.section);
          });
        });

        sitesList.appendChild(siteEl);
      });
    }

    function toggleSite(siteId) {
      if (activeSiteId === siteId) {
        activeSiteId = null;
        showSection('dashboard-home');
        updatePageHeader('dashboard');
      } else {
        activeSiteId = siteId;
        showSiteSection(siteId, 'overview');
      }
      renderSitesList();
    }

    function showSiteSection(siteId, section) {
      const site = sites.find(s => s.id === siteId);
      if (!site) return;

      activeSiteId = siteId;
      activeSiteBadge.textContent = site.name;
      activeSiteBadge.classList.remove('hidden');

      if (section === 'overview') {
        document.getElementById('site-name-display').textContent = site.name;
        document.getElementById('site-location-display').textContent = site.location || '';
        document.getElementById('site-quality').textContent = site.qualityScore || 'â€”';
        document.getElementById('site-live-link').href = site.url || '#';
        document.getElementById('site-preview-link').href = `${API_BASE}/jobs/${site.jobId}/preview`;

        const statusBadge = document.getElementById('site-status-badge');
        if (site.deployed) {
          statusBadge.className = 'badge px-3 py-1.5 bg-emerald-500/10 text-emerald-400 rounded-lg font-medium flex items-center gap-1.5';
          statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-emerald-400 status-dot-live"></span>Live';
        } else {
          statusBadge.className = 'badge px-3 py-1.5 bg-amber-500/10 text-amber-400 rounded-lg font-medium flex items-center gap-1.5';
          statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>Preview';
        }
      }

      if (section === 'staging') {
        document.getElementById('staging-url').textContent = site.url ? site.url.replace('.vercel.app', '-staging.vercel.app') : 'â€”';
      }

      if (section === 'production') {
        document.getElementById('production-url').textContent = site.url || 'â€”';
      }

      showSection(section);
      updatePageHeader(section, site.name);
      renderSitesList();
    }

    function showSection(section) {
      Object.values(sections).forEach(s => s.classList.add('hidden'));
      const sectionEl = sections[section];
      if (sectionEl) {
        sectionEl.classList.remove('hidden');
        sectionEl.classList.add('fade-in');
      }
      activeSection = section;
    }

    function updatePageHeader(section, siteName = null) {
      const titles = {
        'dashboard': { title: 'Dashboard', subtitle: 'Manage your generated websites' },
        'dashboard-home': { title: 'Dashboard', subtitle: 'Manage your generated websites' },
        'generator': { title: 'New Website', subtitle: 'Generate a professional website' },
        'overview': { title: siteName || 'Site Overview', subtitle: 'Site management and analytics' },
        'payments': { title: 'Payments', subtitle: `${siteName || 'Site'} â€” Payment settings` },
        'leads': { title: 'Leads', subtitle: `${siteName || 'Site'} â€” Lead management` },
        'ai-receptionist': { title: 'AI Receptionist', subtitle: `${siteName || 'Site'} â€” Automated support` },
        'staging': { title: 'Staging', subtitle: `${siteName || 'Site'} â€” Test environment` },
        'production': { title: 'Production', subtitle: `${siteName || 'Site'} â€” Live environment` },
      };

      const header = titles[section] || titles['dashboard'];
      pageTitle.textContent = header.title;
      pageSubtitle.textContent = header.subtitle;

      if (!siteName && section !== 'generator') {
        activeSiteBadge.classList.add('hidden');
      }
    }

    function updateDashboardStats() {
      document.getElementById('total-sites-count').textContent = sites.length;
      document.getElementById('live-sites-count').textContent = sites.filter(s => s.deployed).length;
      const avgQuality = sites.length > 0 ? Math.round(sites.reduce((sum, s) => sum + (s.qualityScore || 0), 0) / sites.length) : 'â€”';
      document.getElementById('avg-quality-score').textContent = avgQuality;
    }

    function showGenerator() {
      activeSiteId = null;
      activeSiteBadge.classList.add('hidden');
      document.getElementById('generate-form').reset();
      // Reset image URL fields to just one empty field
      const container = document.getElementById('image-urls-container');
      container.innerHTML = `
        <div class="flex gap-2">
          <input
            type="url"
            name="imageUrl"
            placeholder="https://example.com/image1.jpg"
            class="forge-input flex-1 px-4 py-3 rounded-xl text-forge-text font-mono text-sm"
          >
          <button type="button" onclick="addImageUrlField()" class="px-4 py-3 border border-white/10 hover:border-white/20 rounded-xl text-forge-muted hover:text-forge-text transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
          </button>
        </div>
      `;
      showSection('generator');
      updatePageHeader('generator');
      renderSitesList();
    }

    function updateProgress(status) {
      document.getElementById('progress-bar').style.width = `${status.progress}%`;
      document.getElementById('progress-percent').textContent = `${status.progress}%`;
      document.getElementById('progress-step').textContent = status.currentStep || 'Processing...';

      const emojis = { 'scraping': 'ðŸ”', 'processing': 'ðŸ§ ', 'generating': 'âœ¨', 'deploying': 'ðŸš€' };
      document.getElementById('status-emoji').textContent = emojis[status.status] || 'âš¡';

      const titles = {
        'scraping': 'Gathering business data...',
        'processing': 'Analyzing information...',
        'generating': 'Creating your website...',
        'deploying': 'Deploying to the web...',
      };
      document.getElementById('progress-title').textContent = titles[status.status] || 'Generating your website...';
    }

    async function pollJobStatus(jobId, businessName, location) {
      try {
        const response = await fetch(`${API_BASE}/jobs/${jobId}`);
        const status = await response.json();
        updateProgress(status);

        if (status.status === 'complete' || status.status === 'failed') {
          clearInterval(pollInterval);
          const deployed = status.status === 'complete' && status.result?.siteUrl;

          const newSite = {
            id: jobId, jobId: jobId, name: businessName, location: location,
            url: status.result?.siteUrl || status.result?.previewUrl,
            deployed: deployed, qualityScore: status.result?.qualityScore || 0,
            createdAt: new Date().toISOString(),
          };

          sites.unshift(newSite);
          localStorage.setItem('websiteforge_sites', JSON.stringify(sites));
          renderSitesList();
          updateDashboardStats();
          showSiteSection(jobId, 'overview');
        }
      } catch (err) { console.error('Poll error:', err); }
    }

    async function handleRegenerate() {
      if (!activeSiteId) return;
      const site = sites.find(s => s.id === activeSiteId);
      if (!site) return;

      if (!confirm(`Regenerate website for "${site.name}"? This will create a new version.`)) return;

      // Pre-fill form with site data and show generator
      document.getElementById('businessName').value = site.name || '';
      document.getElementById('location').value = site.location || '';
      showSection('generator');
      updatePageHeader('generator');
    }

    async function handleDelete() {
      if (!activeSiteId) return;
      const site = sites.find(s => s.id === activeSiteId);
      if (!site) return;

      if (!confirm(`Delete "${site.name}"? This will remove it from your list.`)) return;

      // Remove from local storage
      sites = sites.filter(s => s.id !== activeSiteId);
      localStorage.setItem('websiteforge_sites', JSON.stringify(sites));

      // Try to delete from database
      try {
        await fetch(`${API_BASE}/sites/${site.jobId}`, { method: 'DELETE' });
      } catch (err) { console.log('Database delete skipped'); }

      activeSiteId = null;
      renderSitesList();
      updateDashboardStats();
      showSection('dashboard-home');
      updatePageHeader('dashboard');
    }

    // Add image URL field (max 5)
    function addImageUrlField() {
      const container = document.getElementById('image-urls-container');
      const existingFields = container.querySelectorAll('input[name="imageUrl"]');
      if (existingFields.length >= 5) {
        alert('Maximum 5 images allowed');
        return;
      }
      const div = document.createElement('div');
      div.className = 'flex gap-2';
      div.innerHTML = `
        <input
          type="url"
          name="imageUrl"
          placeholder="https://example.com/image${existingFields.length + 1}.jpg"
          class="forge-input flex-1 px-4 py-3 rounded-xl text-forge-text font-mono text-sm"
        >
        <button type="button" onclick="this.parentElement.remove()" class="px-4 py-3 border border-red-500/30 hover:border-red-500/50 hover:bg-red-500/10 rounded-xl text-red-400 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      `;
      container.appendChild(div);
    }

    async function handleGenerate(e) {
      e.preventDefault();

      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      const businessName = data.businessName;
      const location = data.location;

      // Collect all image URLs
      const imageUrls = Array.from(document.querySelectorAll('input[name="imageUrl"]'))
        .map(input => input.value.trim())
        .filter(url => url && url.startsWith('http'));

      // Remove single imageUrl and add array
      delete data.imageUrl;
      const requestData = { ...data, imageUrls };

      showSection('progress');
      updatePageHeader('generator');
      updateProgress({ progress: 5, currentStep: 'Starting generation...', status: 'pending' });

      try {
        const response = await fetch(`${API_BASE}/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestData),
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.error || 'Failed to start generation');
        }

        currentJobId = result.jobId;
        pollInterval = setInterval(() => pollJobStatus(currentJobId, businessName, location), 2000);

      } catch (err) {
        document.getElementById('error-message').textContent = err.message;
        showSection('error');
      }
    }

    init();
  </script>
</body>
</html>
